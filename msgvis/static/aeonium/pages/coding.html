<div id="content" class="ng-cloak" ng-cloak ng-controller="Aeonium.controllers.CodingController">
    <span us-spinner="spinnerOptions" spinner-key="page-spinner"></span>
    <div id="coding">
        <div class="box box-top">
            <div id="top-area">
                <h2><span class="stage">Coding</span></h2>
                <div class="" id="labeling">
                    <span us-spinner="spinnerOptions" spinner-key="label-spinner"></span>
                    <div class="col-md-9 tweet-item">
                        <div class="btn btn-image"
                             ng-show="currentMessage.message.media_url && currentMessage.message.media_url.length > 0"
                             data-toggle="modal" data-target="#image-modal"
                             ng-click="selectMedia(currentMessage.message.media_url)">
                            <img class="img-responsive center-block" ng-src="{$ currentMessage.message.media_url $}">
                        </div>

                        <div class="tweet-text">
                                <span ng-repeat="char in currentMessage.characters track by $index"
                                      ng-style="charStyle(currentMessage, $index)">{$ char $}</span>
                        </div>
                    </div>
                    <div class="col-md-3 tweet-submit">
                        <div class="tweet-submit-item">
                            <div class='btn btn-toggle' ng-class="{'active': currentMessage.is_saved}"
                                 ng-click="currentMessage.is_saved=!currentMessage.is_saved"
                                 data-toggle="tooltip" title="Save this tweet"><span
                                    class="glyphicon glyphicon-tag"></span></div>
                            <span> Save this tweet</span>
                        </div>

                        <div class="tweet-submit-item">
                            <div class='btn btn-toggle' ng-class="{'active': currentMessage.is_example}"
                                 ng-click="currentMessage.is_example=!currentMessage.is_example"
                                 data-toggle="tooltip" title="Save as an example"><span
                                    class="glyphicon glyphicon-star"></span></div>
                            <span> Save as an example tweet</span>
                        </div>

                        <div class="tweet-submit-item">
                            <div class='btn btn-toggle' ng-class="{'active': currentMessage.is_ambiguous}"
                                 ng-click="currentMessage.is_ambiguous=!currentMessage.is_ambiguous"
                                 data-toggle="tooltip" title="Mark as ambiguous"><span>?</span></div>
                            <span> Mark as an ambiguous tweet</span>
                        </div>
                        <button class="btn btn-default" ng-disabled="!selectedCode" ng-click="submitLabel()">Submit
                            Code
                        </button>
                    </div>
                </div>
                <div class="" id="codes" data-toggle="buttons">
                    <span us-spinner="spinnerOptions" spinner-key="code-spinner"></span>
                    <div class="btn btn-default" ng-repeat="code in codes"
                         ng-click="selectLabel(code)"
                         ng-class="{'active': code == selectedCode}"
                         ng-style="buttonStyle(code)">
                        <div class="code-name">{$ code.code_text $}</div>
                        <div class="code-definition scroll-y">
                            <p><strong>definition: </strong>{$ code.text $}</p>
                            <p><strong>example: </strong>{$ code.examples[0].text $}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="bottom-area">
                <span us-spinner="spinnerOptions" spinner-key="code-detail-spinner"></span>
                <div class="row" id="panel" ng-show="selectedCode" ng-style="definitionStyle(selectedCode)">
                    <div class="col-md-3 scroll-y">
                        <div class="box box-light box-right">
                            <h2>Review <span>{$ selectedCode.code_text $}</span></h2>
                            <h3>Master Definition</h3>
                            <p>{$ selectedCode.text $}</p>
                            <h3>Master Example</h3>
                            <p>{$ selectedCode.examples[0].text $}</p>
                            <h3>My Definition</h3>
                            <p ng-show="hasDefinition(selectedCode, 'user')">{$
                                Code.definitions_by_code[selectedCode.code_text]["user"].text $}</p>
                            <p ng-hide="hasDefinition(selectedCode, 'user')" class="help-text">You have not provided a
                                definition yet.</p>
                            <h3>My Examples</h3>
                            <p ng-hide="hasExample(selectedCode, 'user')"
                               class="help-text">You have not saved any tweets as exemplar of '<span>{$ selectedCode.code_text $}</span>'.
                            </p>
                            <div ng-repeat="item in Code.definitions_by_code[selectedCode.code_text]['user'].examples"
                                 class="label-item" ng-style="{ 'border-color': codeColor(selectedCode) }">
                                <div class="content">
                                    <div class="item-message" ng-bind-html="item.embedded_html"></div>
                                </div>
                            </div>
                            <h3>My Partner's Definition</h3>
                            <p ng-show="hasDefinition(selectedCode, 'partner')">{$
                                Code.definitions_by_code[selectedCode.code_text]['partner'].text $}</p>
                            <p ng-hide="hasDefinition(selectedCode, 'partner')" class="help-text">Your partner has not
                                provided a definition yet.</p>
                            <h3>My Partner's Examples</h3>
                            <p ng-hide="hasExample(selectedCode, 'partner')"
                               class="help-text">Your partner has not saved any tweets as exemplar of '<span>{$ selectedCode.code_text $}</span>'.
                            </p>
                            <div ng-repeat="item in Code.definitions_by_code[selectedCode.code_text]['partner'].examples"
                                 class="label-item" ng-style="{ 'border-color': codeColor(selectedCode) }">
                                <div class="content">
                                    <div class="item-message" ng-bind-html="item.embedded_html"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 scroll-y">
                        <div class="box box-light">
                            <h2>Keyword distribution for <span>{$ selectedCode.code_text $}</span></h2>
                            <h3>My keywords</h3>
                            <p ng-hide="hasFeatureOfCode(selectedCode, featureList.user)" class="help-text">You have not
                                provided any keywords from tweets labeled as '<span>{$ selectedCode.code_text$}</span>'.
                                You can do so in the review stage.</p>
                            <div class="features" ng-repeat="feature in featureList.user track by $index"
                                 ng-show="filterFeatures(selectedCode, feature)" id="user-features"
                                 ng-click="searchFeature(feature)" ng-style="myKeywordStyle(feature)">
                                    <span class="feature-text"
                                          popover data-toggle="popover" data-trigger="hover" data-html="true"
                                          ng-attr-data-content="Keywords added from a tweet coded as '{$ code_map[feature.origin_code_id].code_text $}'"
                                          data-placement="auto top">{$ feature.feature_text $}</span>
                                <div ng-show="feature.total_count > 0" class="feature-distribution">
                                    <div ng-repeat="code in code_text_list"
                                         ng-style="distributionStyle(code, feature.normalized_distribution[code])"
                                         popover data-toggle="popover" data-trigger="hover" data-html="true"
                                         ng-attr-data-content="{$ feature.distribution[code] + ' tweet' + (feature.distribution[code] > 1 ? 's' : '') + ' for ' + code $}"
                                         data-placement="auto top"></div>
                                </div>
                                <div ng-show="feature.total_count == 0"
                                     class="feature-distribution feature-empty"></div>
                                <span class="feature-total">{$ feature.total_count $}</span>
                            </div>
                            <h3>My partner's keywords</h3>
                            <p ng-hide="hasFeatureOfCode(selectedCode, featureList.partner)" class="help-text">Your
                                partner does not have any keyword for '<span>{$ selectedCode.code_text$}</span>'.</p>
                            <div class="features" ng-repeat="feature in featureList.partner track by $index "
                                 ng-show="filterFeatures(selectedCode, feature)" id="partner-features"
                                 ng-click="searchFeature(feature)" ng-style="myKeywordStyle(feature)">
                                    <span class="feature-text"
                                          popover data-toggle="popover" data-trigger="hover" data-html="true"
                                          ng-attr-data-content="Keywords added from a tweet coded as '{$ code_map[feature.origin_code_id].code_text $}'"
                                          data-placement="auto top">{$ feature.feature_text $}</span>
                                <div ng-show="feature.total_count > 0" class="feature-distribution">
                                    <div ng-repeat="code in code_text_list"
                                         ng-style="distributionStyle(code, feature.normalized_distribution[code])"
                                         popover data-toggle="popover" data-trigger="hover" data-html="true"
                                         ng-attr-data-content="{$ feature.distribution[code] + ' tweet' + (feature.distribution[code] > 1 ? 's' : '') + ' for ' + code $}"
                                         data-placement="auto top"></div>
                                </div>
                                <div ng-show="feature.total_count == 0"
                                     class="feature-distribution feature-empty"></div>
                                <span class="feature-total">{$ feature.total_count $}</span>
                            </div>
                            <h3>System keywords</h3>
                            <p ng-hide="hasFeatureOfCode(selectedCode, featureList.system)" class="help-text">There are
                                no system keywords from tweets labeled as '<span>{$ selectedCode.code_text$}</span>'.
                            </p>
                            <div class="features" ng-repeat="feature in featureList.system track by $index"
                                 ng-show="filterFeatures(selectedCode, feature)" id="system-features"
                                 ng-click="searchFeature(feature)">
                                <span class="feature-text">{$ feature.feature_text $}</span>
                                <div ng-show="feature.total_count > 0" class="feature-distribution">
                                    <div ng-repeat="code in code_text_list"
                                         ng-style="distributionStyle(code, feature.normalized_distribution[code])"
                                         popover data-toggle="popover" data-trigger="hover" data-html="true"
                                         ng-attr-data-content="{$ feature.distribution[code] + ' tweet' + (feature.distribution[code] > 1 ? 's' : '') + ' for ' + code $}"
                                         data-placement="auto top"></div>
                                </div>
                                <div ng-show="feature.total_count == 0"
                                     class="feature-distribution feature-empty"></div>
                                <span class="feature-total">{$ feature.total_count $}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 scroll-y">
                        <div class="box box-light box-left">
                            <h2>My Tweets labeled as <span>{$ selectedCode.code_text $}</span></h2>

                            <div id="search">
                                <div class="search-label">Show:</div>
                                <div class="dropdown item-filter">
                                    <button class="btn btn-default dropdown-toggle" type="button" id="filterMenu"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                        <span>{$ selectedFilter $}</span>
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="filterMenu">
                                        <li><a ng-click="selectFilter('All')">All</a></li>
                                        <li><a ng-click="selectFilter('Example')">Example</a></li>
                                        <li><a ng-click="selectFilter('Saved')">Saved</a></li>
                                        <li><a ng-click="selectFilter('Ambiguous')">Ambiguous</a></li>
                                    </ul>
                                </div>
                                <div class="search-label">Search:</div>
                                <input ng-if="!search.feature" ng-model="search.text"
                                       placeholder="Type in search keywords">
                                <div class="search-feature" ng-if="search.feature"
                                     ng-style="{ 'border-color': pillColor(search.feature.origin_code_id) }">{$
                                    search.feature.feature_text $}
                                    <button class="btn btn-default" ng-click="removeSearchFeature()"
                                            data-toggle="tooltip" title="Remove this keyword from search">
                                        <span class="glyphicon glyphicon-remove-circle"></span>
                                    </button>
                                </div>
                            </div>
                            <div ng-repeat="item in coded_messages['user'][selectedCode.code_text] | filter:filterTweetsFlag()"
                                 class="label-item" ng-style="{ 'border-color': codeColor(selectedCode) }"
                                 ng-mouseover="onItemHover(item)" ng-mouseleave="onItemLeave(item)"
                                 ng-class="{ hovered: hoveredItem==item }">

                                <div class="content">
                                    <div class="item" ng-show="hoveredItem==item">
                                        <div ng-show="true">
                                            <div class='btn btn-toggle' ng-class="{'active': item.is_saved}"
                                                 ng-click="updateItem(item, !item.is_saved, item.is_example, item.is_ambiguous)"
                                                 data-toggle="tooltip" title="Save this tweet"><span
                                                    class="glyphicon glyphicon-tag"></span></div>
                                            <div class='btn btn-toggle' ng-class="{'active': item.is_example}"
                                                 ng-click="updateItem(item, item.is_saved, !item.is_example, item.is_ambiguous)"
                                                 data-toggle="tooltip" title="Save as an example"><span
                                                    class="glyphicon glyphicon-star"></span></div>
                                            <div class='btn btn-toggle' ng-class="{'active': item.is_ambiguous}"
                                                 ng-click="updateItem(item, item.is_saved, item.is_example, !item.is_ambiguous)"
                                                 data-toggle="tooltip" title="Mark as ambiguous"><span>?</span></div>
                                        </div>
                                        <div ng-bind-html="item.message.embedded_html"></div>
                                    </div>
                                    <div class="item-message" ng-hide="hoveredItem==item"
                                         ng-bind-html="item.message.embedded_html"></div>
                                </div>
                            </div>

                            <p ng-show="coded_messages!=undefined && (coded_messages['user'][selectedCode.code_text] | filter:filterTweetsFlag()).length==0"
                               class="help-text">No tweets were found.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="image-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h2 class="modal-title">Embedded image</h2>
                </div>
                <div class="modal-body">
                    <img class="img-responsive center-block" ng-src="{$ selectedMedia $}">
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</div>